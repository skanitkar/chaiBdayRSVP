<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chai's 1st Birthday RSVP üêæ</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<style>
  :root {
    --gold-deep: #8B6914;
    --gold: #C9961A;
    --gold-light: #E8C547;
    --gold-glow: #F5D96B;
    --brown-dark: #2C1810;
    --brown: #4A2C1A;
    --brown-mid: #6B3E24;
    --brown-light: #8B5E3C;
    --cream: #FFF8E7;
    --cream-dark: #F0E0C0;
    --warm-white: #FFFDF5;
    --paw-gold: #D4A83B;
    --success: #4A7C59;
    --error: #A0392D;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--brown-dark);
    color: var(--cream);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Background texture */
  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: 
      radial-gradient(ellipse at 20% 20%, rgba(201, 150, 26, 0.08) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 80%, rgba(201, 150, 26, 0.06) 0%, transparent 50%),
      radial-gradient(ellipse at 50% 50%, rgba(107, 62, 36, 0.3) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  /* Floating paw prints */
  .paw-bg {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    z-index: 0;
    overflow: hidden;
  }
  .paw-bg .paw {
    position: absolute;
    font-size: 1.4rem;
    opacity: 0.06;
    animation: float 20s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(-20px) rotate(10deg); }
    50% { transform: translateY(-10px) rotate(-5deg); }
    75% { transform: translateY(-25px) rotate(8deg); }
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 560px;
    margin: 0 auto;
    padding: 20px 16px 60px;
  }

  /* Header / Invite Preview */
  .invite-header {
    text-align: center;
    margin-bottom: 36px;
    animation: fadeInDown 0.8s ease-out;
  }

  @keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes scaleIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
  }

  .invite-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, var(--gold-deep), var(--gold));
    color: var(--cream);
    padding: 8px 20px;
    border-radius: 50px;
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 24px;
  }

  .invite-title {
    font-family: 'Playfair Display', serif;
    font-size: 2.6rem;
    font-weight: 900;
    line-height: 1.1;
    color: var(--gold-glow);
    text-shadow: 0 2px 20px rgba(201, 150, 26, 0.3);
    margin-bottom: 6px;
  }

  .invite-subtitle {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.3rem;
    font-style: italic;
    color: var(--cream-dark);
    opacity: 0.85;
    margin-bottom: 20px;
  }

  .event-details {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 20px;
  }

  .event-detail {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.1rem;
    color: var(--cream-dark);
  }

  .event-detail .icon {
    font-size: 1.1rem;
    width: 28px;
    text-align: center;
  }

  .divider {
    width: 80px;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
    margin: 16px auto;
  }

  .tagline {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    font-size: 1.15rem;
    color: var(--gold-light);
    text-shadow: 0 1px 8px rgba(201, 150, 26, 0.2);
  }

  /* Form Card */
  .form-card {
    background: linear-gradient(165deg, rgba(74, 44, 26, 0.7), rgba(44, 24, 16, 0.85));
    border: 1px solid rgba(201, 150, 26, 0.2);
    border-radius: 20px;
    padding: 32px 28px;
    backdrop-filter: blur(10px);
    box-shadow: 
      0 20px 60px rgba(0,0,0,0.4),
      inset 0 1px 0 rgba(201, 150, 26, 0.1);
    animation: fadeInUp 0.8s ease-out 0.2s both;
  }

  .form-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    color: var(--gold-glow);
    text-align: center;
    margin-bottom: 24px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-label {
    display: block;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--cream-dark);
    margin-bottom: 8px;
    letter-spacing: 0.5px;
  }

  .form-input, .form-select {
    width: 100%;
    padding: 14px 16px;
    background: rgba(255, 248, 231, 0.08);
    border: 1.5px solid rgba(201, 150, 26, 0.25);
    border-radius: 12px;
    color: var(--cream);
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    transition: all 0.3s ease;
    outline: none;
  }

  .form-input::placeholder {
    color: rgba(240, 224, 192, 0.4);
  }

  .form-input:focus, .form-select:focus {
    border-color: var(--gold);
    background: rgba(255, 248, 231, 0.12);
    box-shadow: 0 0 0 3px rgba(201, 150, 26, 0.1);
  }

  .form-select {
    appearance: none;
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' fill='%23C9961A'%3E%3Cpath d='M6 8L0 0h12z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
    padding-right: 40px;
  }

  .form-select option {
    background: var(--brown);
    color: var(--cream);
  }

  /* Attendance toggle */
  .attendance-options {
    display: flex;
    gap: 12px;
  }

  .attendance-btn {
    flex: 1;
    padding: 14px;
    border: 1.5px solid rgba(201, 150, 26, 0.25);
    border-radius: 12px;
    background: rgba(255, 248, 231, 0.05);
    color: var(--cream-dark);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
  }

  .attendance-btn:hover {
    border-color: var(--gold);
    background: rgba(201, 150, 26, 0.1);
  }

  .attendance-btn.active-yes {
    background: linear-gradient(135deg, rgba(74, 124, 89, 0.3), rgba(74, 124, 89, 0.15));
    border-color: var(--success);
    color: #A8D5BA;
    box-shadow: 0 0 12px rgba(74, 124, 89, 0.15);
  }

  .attendance-btn.active-no {
    background: linear-gradient(135deg, rgba(160, 57, 45, 0.3), rgba(160, 57, 45, 0.15));
    border-color: var(--error);
    color: #E8A09A;
    box-shadow: 0 0 12px rgba(160, 57, 45, 0.15);
  }

  .attendance-btn .btn-emoji {
    display: block;
    font-size: 1.5rem;
    margin-bottom: 4px;
  }

  /* Pet section */
  .pet-section {
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transition: max-height 0.5s ease, opacity 0.4s ease, margin 0.4s ease;
  }

  .pet-section.visible {
    max-height: 200px;
    opacity: 1;
    margin-top: 20px;
  }

  .pet-toggle {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    padding: 12px 16px;
    background: rgba(212, 168, 59, 0.08);
    border: 1.5px solid rgba(201, 150, 26, 0.2);
    border-radius: 12px;
    transition: all 0.3s ease;
    user-select: none;
  }

  .pet-toggle:hover {
    background: rgba(212, 168, 59, 0.15);
  }

  .pet-checkbox {
    display: none;
  }

  .pet-check-visual {
    width: 24px;
    height: 24px;
    border: 2px solid var(--gold);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    transition: all 0.3s ease;
    flex-shrink: 0;
  }

  .pet-checkbox:checked + .pet-check-visual {
    background: var(--gold);
    color: var(--brown-dark);
  }

  .pet-label-text {
    font-size: 0.95rem;
    color: var(--cream-dark);
  }

  /* Submit */
  .submit-btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--gold-deep), var(--gold));
    border: none;
    border-radius: 14px;
    color: var(--cream);
    font-family: 'Playfair Display', serif;
    font-size: 1.15rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
    margin-top: 8px;
  }

  .submit-btn::before {
    content: '';
    position: absolute;
    top: 0; left: -100%; right: 0; bottom: 0;
    width: 300%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    transition: left 0.5s ease;
  }

  .submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(201, 150, 26, 0.35);
  }

  .submit-btn:hover::before {
    left: 100%;
  }

  .submit-btn:active {
    transform: translateY(0);
  }

  .submit-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
  }

  /* Existing RSVP lookup */
  .lookup-section {
    margin-top: 24px;
    text-align: center;
    animation: fadeInUp 0.8s ease-out 0.4s both;
  }

  .lookup-text {
    font-size: 0.85rem;
    color: rgba(240, 224, 192, 0.5);
    margin-bottom: 8px;
  }

  .lookup-link {
    color: var(--gold-light);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: color 0.2s ease;
    border-bottom: 1px dashed rgba(201, 150, 26, 0.4);
    padding-bottom: 2px;
  }

  .lookup-link:hover {
    color: var(--gold-glow);
  }

  /* Success state */
  .success-card {
    text-align: center;
    padding: 40px 28px;
    animation: scaleIn 0.5s ease-out;
  }

  .success-icon {
    font-size: 4rem;
    margin-bottom: 16px;
    animation: bounce 0.6s ease-out;
  }

  @keyframes bounce {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }

  .success-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.8rem;
    color: var(--gold-glow);
    margin-bottom: 12px;
  }

  .success-text {
    font-size: 1rem;
    color: var(--cream-dark);
    opacity: 0.8;
    line-height: 1.6;
    margin-bottom: 24px;
  }

  .modify-btn, .back-btn {
    display: inline-block;
    padding: 12px 28px;
    border: 1.5px solid var(--gold);
    border-radius: 10px;
    background: transparent;
    color: var(--gold-light);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .modify-btn:hover, .back-btn:hover {
    background: rgba(201, 150, 26, 0.15);
  }

  /* Messages */
  .message {
    padding: 12px 16px;
    border-radius: 10px;
    font-size: 0.9rem;
    margin-bottom: 16px;
    display: none;
  }

  .message.error {
    display: block;
    background: rgba(160, 57, 45, 0.2);
    border: 1px solid rgba(160, 57, 45, 0.4);
    color: #E8A09A;
  }

  .message.info {
    display: block;
    background: rgba(201, 150, 26, 0.15);
    border: 1px solid rgba(201, 150, 26, 0.3);
    color: var(--gold-light);
  }

  /* Admin Panel */
  .admin-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 100;
    backdrop-filter: blur(5px);
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .admin-overlay.show { display: flex; align-items: flex-start; justify-content: center; padding: 20px; overflow-y: auto; }

  .admin-panel {
    width: 100%;
    max-width: 700px;
    background: linear-gradient(170deg, var(--brown), var(--brown-dark));
    border: 1px solid rgba(201, 150, 26, 0.3);
    border-radius: 20px;
    padding: 32px 24px;
    margin: 20px 0;
    animation: scaleIn 0.3s ease-out;
  }

  .admin-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
  }

  .admin-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    color: var(--gold-glow);
  }

  .admin-close {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 1px solid rgba(201, 150, 26, 0.3);
    background: transparent;
    color: var(--cream-dark);
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .admin-close:hover {
    background: rgba(201, 150, 26, 0.15);
  }

  .admin-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
    margin-bottom: 24px;
  }

  .stat-card {
    background: rgba(255, 248, 231, 0.06);
    border: 1px solid rgba(201, 150, 26, 0.15);
    border-radius: 12px;
    padding: 16px;
    text-align: center;
  }

  .stat-number {
    font-family: 'Playfair Display', serif;
    font-size: 2rem;
    font-weight: 900;
    color: var(--gold-glow);
  }

  .stat-label {
    font-size: 0.75rem;
    color: var(--cream-dark);
    opacity: 0.7;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 4px;
  }

  .guest-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .guest-row {
    display: grid;
    grid-template-columns: 1.5fr 0.7fr 0.6fr 1fr;
    gap: 8px;
    padding: 14px 16px;
    background: rgba(255, 248, 231, 0.05);
    border: 1px solid rgba(201, 150, 26, 0.1);
    border-radius: 10px;
    align-items: center;
    font-size: 0.9rem;
  }

  .guest-row.header {
    background: rgba(201, 150, 26, 0.12);
    font-weight: 700;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--gold-light);
  }

  .guest-name { 
    color: var(--cream); 
    font-weight: 600;
  }

  .guest-status {
    font-size: 0.8rem;
    padding: 4px 10px;
    border-radius: 20px;
    text-align: center;
    font-weight: 600;
  }

  .status-yes {
    background: rgba(74, 124, 89, 0.2);
    color: #A8D5BA;
  }

  .status-no {
    background: rgba(160, 57, 45, 0.2);
    color: #E8A09A;
  }

  .guest-count {
    text-align: center;
    color: var(--cream-dark);
  }

  .guest-pet {
    color: var(--gold-light);
    font-size: 0.85rem;
  }

  .admin-empty {
    text-align: center;
    padding: 40px 20px;
    color: var(--cream-dark);
    opacity: 0.5;
    font-style: italic;
  }

  /* Lookup modal */
  .lookup-modal {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    z-index: 90;
    backdrop-filter: blur(5px);
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .lookup-modal.show { display: flex; }

  .lookup-card {
    background: linear-gradient(170deg, var(--brown), var(--brown-dark));
    border: 1px solid rgba(201, 150, 26, 0.3);
    border-radius: 20px;
    padding: 32px 28px;
    width: 100%;
    max-width: 400px;
    animation: scaleIn 0.3s ease-out;
  }

  .lookup-card h3 {
    font-family: 'Playfair Display', serif;
    color: var(--gold-glow);
    font-size: 1.3rem;
    margin-bottom: 16px;
    text-align: center;
  }

  .lookup-actions {
    display: flex;
    gap: 10px;
    margin-top: 16px;
  }

  .lookup-actions button {
    flex: 1;
  }

  /* Footer */
  .footer {
    text-align: center;
    margin-top: 32px;
    animation: fadeInUp 0.8s ease-out 0.6s both;
  }

  .admin-trigger {
    font-size: 0.7rem;
    color: rgba(201, 150, 26, 0.2);
    cursor: pointer;
    transition: color 0.3s ease;
    border: none;
    background: none;
    font-family: 'DM Sans', sans-serif;
  }

  .admin-trigger:hover {
    color: rgba(201, 150, 26, 0.5);
  }

  /* Loading spinner */
  .spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255,248,231,0.3);
    border-top-color: var(--cream);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    margin-right: 8px;
    vertical-align: middle;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* No Firebase Warning */
  .firebase-warning {
    background: rgba(201, 150, 26, 0.12);
    border: 1px solid rgba(201, 150, 26, 0.3);
    border-radius: 14px;
    padding: 20px;
    margin-bottom: 24px;
    text-align: center;
  }

  .firebase-warning h3 {
    font-family: 'Playfair Display', serif;
    color: var(--gold-glow);
    font-size: 1.1rem;
    margin-bottom: 10px;
  }

  .firebase-warning p {
    font-size: 0.85rem;
    color: var(--cream-dark);
    opacity: 0.8;
    line-height: 1.5;
  }

  .firebase-warning code {
    display: block;
    text-align: left;
    background: rgba(0,0,0,0.3);
    padding: 12px;
    border-radius: 8px;
    font-size: 0.75rem;
    margin-top: 10px;
    word-break: break-all;
    line-height: 1.6;
    color: var(--gold-light);
  }

  /* Mobile responsiveness */
  @media (max-width: 480px) {
    .container { padding: 16px 12px 40px; }
    .invite-title { font-size: 2rem; }
    .form-card { padding: 24px 18px; }
    .guest-row {
      grid-template-columns: 1fr 1fr;
      gap: 6px;
    }
    .guest-row.header { display: none; }
    .guest-row:not(.header) {
      position: relative;
      padding: 14px;
    }
    .admin-panel { padding: 24px 16px; }
  }
</style>
</head>
<body>

<!-- Floating paw prints background -->
<div class="paw-bg" id="pawBg"></div>

<!-- RSVP View -->
<div class="container" id="mainView">
  
  <!-- Header -->
  <div class="invite-header">
    <div class="invite-badge">üêæ You're Invited üêæ</div>
    <h1 class="invite-title">One Golden Year<br>of Chai!</h1>
    <p class="invite-subtitle">Please join us to celebrate</p>
    
    <div class="event-details">
      <div class="event-detail">
        <span class="icon">üìÖ</span>
        <span>28th February 2026</span>
      </div>
      <div class="event-detail">
        <span class="icon">üïë</span>
        <span>2:30 PM ‚Äì 5:30 PM</span>
      </div>
      <div class="event-detail">
        <span class="icon">üìç</span>
        <span>1069 Rye Ct, San Jose</span>
      </div>
    </div>

    <div class="divider"></div>
    <p class="tagline">It's all golden! ‚ú®</p>
  </div>

  <!-- Firebase setup warning (shown if config not set) -->
  <div class="firebase-warning" id="firebaseWarning" style="display:none;">
    <h3>‚öôÔ∏è Firebase Setup Required</h3>
    <p>To enable persistent data, add your Firebase config to this file. Replace the placeholder in the script at the bottom with your project's config:</p>
    <code>
      apiKey: "your-api-key",<br>
      authDomain: "your-project.firebaseapp.com",<br>
      projectId: "your-project-id",<br>
      storageBucket: "your-project.appspot.com",<br>
      messagingSenderId: "123456789",<br>
      appId: "your-app-id"
    </code>
    <p style="margin-top:10px;">The form still works ‚Äî data will persist once Firebase is configured.</p>
  </div>

  <!-- Message area -->
  <div id="formMessage" class="message"></div>

  <!-- RSVP Form -->
  <div class="form-card" id="rsvpForm">
    <h2 class="form-title">üêæ RSVP for Chai's Party</h2>

    <div class="form-group">
      <label class="form-label">Your Name</label>
      <input type="text" class="form-input" id="guestName" placeholder="Enter your full name" autocomplete="name">
    </div>

    <div class="form-group">
      <label class="form-label">Will you be attending?</label>
      <div class="attendance-options">
        <button class="attendance-btn" id="btnYes" onclick="setAttendance(true)">
          <span class="btn-emoji">üéâ</span>
          Paws-itively Yes!
        </button>
        <button class="attendance-btn" id="btnNo" onclick="setAttendance(false)">
          <span class="btn-emoji">üòø</span>
          Can't make it
        </button>
      </div>
    </div>

    <div class="form-group" id="guestCountGroup" style="display:none;">
      <label class="form-label">How many people (including you)?</label>
      <select class="form-select" id="guestCount">
        <option value="1">1 person</option>
        <option value="2">2 people</option>
        <option value="3">3 people</option>
        <option value="4">4 people</option>
        <option value="5">5 people</option>
        <option value="6">6+ people</option>
      </select>
    </div>

    <div id="petSection" style="display:none;">
      <div class="form-group">
        <label class="pet-toggle" for="hasPet">
          <input type="checkbox" id="hasPet" class="pet-checkbox" onchange="togglePetName()">
          <span class="pet-check-visual">üêæ</span>
          <span class="pet-label-text">I'm bringing my furry friend!</span>
        </label>
      </div>

      <div class="pet-section" id="petNameSection">
        <div class="form-group" style="margin-bottom:0;">
          <label class="form-label">What's your pet's name?</label>
          <input type="text" class="form-input" id="petName" placeholder="e.g. Buddy, Luna, Max...">
        </div>
      </div>
    </div>

    <button class="submit-btn" id="submitBtn" onclick="submitRSVP()">
      Submit RSVP üêæ
    </button>
  </div>

  <!-- Success State -->
  <div class="form-card success-card" id="successView" style="display:none;">
    <div class="success-icon" id="successEmoji">üéâ</div>
    <h2 class="success-title" id="successTitle">Woof-tastic!</h2>
    <p class="success-text" id="successText"></p>
    <button class="modify-btn" onclick="showModifyForm()">Modify My RSVP</button>
  </div>

  <!-- Already submitted / Lookup -->
  <div class="lookup-section">
    <p class="lookup-text">Already RSVP'd?</p>
    <a class="lookup-link" onclick="showLookup()">Look up & modify your response</a>
  </div>

  <!-- Footer with hidden admin trigger -->
  <div class="footer">
    <button class="admin-trigger" onclick="showAdminLogin()">üêæ</button>
  </div>
</div>

<!-- Lookup Modal -->
<div class="lookup-modal" id="lookupModal">
  <div class="lookup-card">
    <h3>Find Your RSVP</h3>
    <div class="form-group">
      <label class="form-label">Enter your name</label>
      <input type="text" class="form-input" id="lookupName" placeholder="Your full name">
    </div>
    <div id="lookupMessage" class="message"></div>
    <div class="lookup-actions">
      <button class="back-btn" onclick="closeLookup()">Cancel</button>
      <button class="submit-btn" style="margin-top:0;" onclick="lookupRSVP()">Find</button>
    </div>
  </div>
</div>

<!-- Admin Overlay -->
<div class="admin-overlay" id="adminOverlay">
  <div class="admin-panel">
    <div class="admin-header">
      <h2 class="admin-title">üêæ Guest Dashboard</h2>
      <button class="admin-close" onclick="closeAdmin()">‚úï</button>
    </div>

    <!-- Admin login -->
    <div id="adminLogin">
      <div class="form-group">
        <label class="form-label">Enter Admin Password</label>
        <input type="password" class="form-input" id="adminPass" placeholder="Password">
      </div>
      <div id="adminLoginMsg" class="message"></div>
      <button class="submit-btn" onclick="doAdminLogin()">View Responses</button>
    </div>

    <!-- Admin dashboard -->
    <div id="adminDashboard" style="display:none;">
      <div class="admin-stats" id="adminStats"></div>
      <div class="guest-list" id="guestList"></div>
    </div>
  </div>
</div>

<script>
  // =============================================
  // üî• FIREBASE CONFIGURATION
  // =============================================
  // Replace with your Firebase project config
  const firebaseConfig = {
    apiKey: "AIzaSyAoAtfq9dsXG4BrHlbLVOsVTo5rDiDMRzc",
    authDomain: "chai-bday-rsvp.firebaseapp.com",
    projectId: "chai-bday-rsvp",
    storageBucket: "chai-bday-rsvp.firebasestorage.app",
    messagingSenderId: "476888653162",
    appId: "1:476888653162:web:a40a4f93e72b7085325913",
    measurementId: "G-PE8W6ZS4J5"
  };

  // Admin password - change this!
  const ADMIN_PASSWORD = "chaigolden1";

  // =============================================
  // Initialize Firebase
  // =============================================
  let db = null;
  let firebaseReady = false;

  try {
    if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      firebaseReady = true;
    } else {
      document.getElementById('firebaseWarning').style.display = 'block';
    }
  } catch (e) {
    console.error('Firebase init error:', e);
    document.getElementById('firebaseWarning').style.display = 'block';
  }

  // =============================================
  // Generate background paw prints
  // =============================================
  const pawBg = document.getElementById('pawBg');
  for (let i = 0; i < 20; i++) {
    const paw = document.createElement('span');
    paw.className = 'paw';
    paw.textContent = 'üêæ';
    paw.style.left = Math.random() * 100 + '%';
    paw.style.top = Math.random() * 100 + '%';
    paw.style.animationDelay = Math.random() * 20 + 's';
    paw.style.transform = `rotate(${Math.random() * 360}deg)`;
    pawBg.appendChild(paw);
  }

  // =============================================
  // Form state
  // =============================================
  let attending = null;
  let editingDocId = null;

  function setAttendance(val) {
    attending = val;
    const btnYes = document.getElementById('btnYes');
    const btnNo = document.getElementById('btnNo');
    
    btnYes.className = 'attendance-btn' + (val ? ' active-yes' : '');
    btnNo.className = 'attendance-btn' + (!val ? ' active-no' : '');
    
    document.getElementById('guestCountGroup').style.display = val ? 'block' : 'none';
    document.getElementById('petSection').style.display = val ? 'block' : 'none';
    
    if (!val) {
      document.getElementById('hasPet').checked = false;
      togglePetName();
    }
  }

  function togglePetName() {
    const section = document.getElementById('petNameSection');
    const checked = document.getElementById('hasPet').checked;
    section.classList.toggle('visible', checked);
  }

  // =============================================
  // Submit RSVP
  // =============================================
  async function submitRSVP() {
    const name = document.getElementById('guestName').value.trim();
    const msgEl = document.getElementById('formMessage');
    
    // Validation
    if (!name) {
      showMessage(msgEl, 'error', 'Please enter your name.');
      return;
    }
    if (attending === null) {
      showMessage(msgEl, 'error', 'Please select whether you\'re attending.');
      return;
    }

    const data = {
      name: name,
      attending: attending,
      guestCount: attending ? parseInt(document.getElementById('guestCount').value) : 0,
      hasPet: attending ? document.getElementById('hasPet').checked : false,
      petName: (attending && document.getElementById('hasPet').checked) ? document.getElementById('petName').value.trim() : '',
      updatedAt: new Date().toISOString()
    };

    if (!firebaseReady) {
      // Demo mode
      showSuccess(data);
      return;
    }

    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span> Submitting...';

    try {
      if (editingDocId) {
        // Update existing
        await db.collection('rsvps').doc(editingDocId).update(data);
      } else {
        // Check for duplicate name
        const existing = await db.collection('rsvps')
          .where('name', '==', name)
          .get();
        
        if (!existing.empty) {
          // Update existing entry
          await db.collection('rsvps').doc(existing.docs[0].id).update(data);
        } else {
          // Create new
          data.createdAt = new Date().toISOString();
          await db.collection('rsvps').add(data);
        }
      }

      showSuccess(data);
    } catch (err) {
      console.error('Submit error:', err);
      showMessage(msgEl, 'error', 'Something went wrong. Please try again.');
    } finally {
      btn.disabled = false;
      btn.innerHTML = 'Submit RSVP üêæ';
    }
  }

  function showSuccess(data) {
    document.getElementById('rsvpForm').style.display = 'none';
    document.getElementById('successView').style.display = 'block';
    document.getElementById('formMessage').className = 'message';

    if (data.attending) {
      document.getElementById('successEmoji').textContent = 'üéâ';
      document.getElementById('successTitle').textContent = 'Woof-tastic!';
      let text = `Thanks, ${data.name}! We can't wait to see you`;
      if (data.guestCount > 1) text += ` and your ${data.guestCount - 1} guest${data.guestCount > 2 ? 's' : ''}`;
      text += ` at Chai's party!`;
      if (data.hasPet && data.petName) text += ` üêï ${data.petName} is welcome too!`;
      document.getElementById('successText').textContent = text;
    } else {
      document.getElementById('successEmoji').textContent = 'üò¢';
      document.getElementById('successTitle').textContent = 'We\'ll miss you!';
      document.getElementById('successText').textContent = `Thanks for letting us know, ${data.name}. Chai will save you a virtual treat! ü¶¥`;
    }
  }

  function showModifyForm() {
    document.getElementById('rsvpForm').style.display = 'block';
    document.getElementById('successView').style.display = 'none';
    attending = null;
    editingDocId = null;
    document.getElementById('btnYes').className = 'attendance-btn';
    document.getElementById('btnNo').className = 'attendance-btn';
    document.getElementById('guestCountGroup').style.display = 'none';
    document.getElementById('petSection').style.display = 'none';
  }

  // =============================================
  // Lookup existing RSVP
  // =============================================
  function showLookup() {
    document.getElementById('lookupModal').classList.add('show');
    document.getElementById('lookupName').focus();
  }

  function closeLookup() {
    document.getElementById('lookupModal').classList.remove('show');
    document.getElementById('lookupName').value = '';
    document.getElementById('lookupMessage').className = 'message';
  }

  async function lookupRSVP() {
    const name = document.getElementById('lookupName').value.trim();
    const msgEl = document.getElementById('lookupMessage');

    if (!name) {
      showMessage(msgEl, 'error', 'Please enter your name.');
      return;
    }

    if (!firebaseReady) {
      showMessage(msgEl, 'info', 'Firebase not configured. Demo mode active.');
      return;
    }

    try {
      const snapshot = await db.collection('rsvps')
        .where('name', '==', name)
        .get();

      if (snapshot.empty) {
        showMessage(msgEl, 'error', 'No RSVP found for that name. Check spelling or submit a new one.');
        return;
      }

      const doc = snapshot.docs[0];
      const data = doc.data();
      editingDocId = doc.id;

      // Populate form with existing data
      document.getElementById('guestName').value = data.name;
      setAttendance(data.attending);
      
      if (data.attending) {
        document.getElementById('guestCount').value = data.guestCount;
        document.getElementById('hasPet').checked = data.hasPet;
        togglePetName();
        if (data.hasPet && data.petName) {
          document.getElementById('petName').value = data.petName;
        }
      }

      closeLookup();
      showMessage(document.getElementById('formMessage'), 'info', `Found your RSVP, ${data.name}! Make changes and resubmit.`);
      
      // Show form if success view was showing
      document.getElementById('rsvpForm').style.display = 'block';
      document.getElementById('successView').style.display = 'none';

    } catch (err) {
      console.error('Lookup error:', err);
      showMessage(msgEl, 'error', 'Something went wrong. Please try again.');
    }
  }

  // =============================================
  // Admin Panel
  // =============================================
  function showAdminLogin() {
    document.getElementById('adminOverlay').classList.add('show');
    document.getElementById('adminLogin').style.display = 'block';
    document.getElementById('adminDashboard').style.display = 'none';
    document.getElementById('adminPass').focus();
  }

  function closeAdmin() {
    document.getElementById('adminOverlay').classList.remove('show');
    document.getElementById('adminPass').value = '';
    document.getElementById('adminLoginMsg').className = 'message';
  }

  async function doAdminLogin() {
    const pass = document.getElementById('adminPass').value;
    const msgEl = document.getElementById('adminLoginMsg');

    if (pass !== ADMIN_PASSWORD) {
      showMessage(msgEl, 'error', 'Incorrect password.');
      return;
    }

    document.getElementById('adminLogin').style.display = 'none';
    document.getElementById('adminDashboard').style.display = 'block';

    if (!firebaseReady) {
      document.getElementById('guestList').innerHTML = '<div class="admin-empty">Firebase not configured. No data to display.</div>';
      return;
    }

    try {
      const snapshot = await db.collection('rsvps').orderBy('createdAt', 'desc').get();
      const guests = [];
      snapshot.forEach(doc => guests.push({ id: doc.id, ...doc.data() }));

      renderDashboard(guests);
    } catch (err) {
      console.error('Admin load error:', err);
      document.getElementById('guestList').innerHTML = '<div class="admin-empty">Error loading data. Check Firestore rules.</div>';
    }
  }

  function renderDashboard(guests) {
    const totalRSVPs = guests.length;
    const attending_guests = guests.filter(g => g.attending);
    const declining = guests.filter(g => !g.attending);
    const totalPeople = attending_guests.reduce((sum, g) => sum + (g.guestCount || 1), 0);
    const petsCount = guests.filter(g => g.hasPet).length;

    document.getElementById('adminStats').innerHTML = `
      <div class="stat-card">
        <div class="stat-number">${totalRSVPs}</div>
        <div class="stat-label">Total RSVPs</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">${attending_guests.length}</div>
        <div class="stat-label">Attending</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">${totalPeople}</div>
        <div class="stat-label">Total People</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">${declining.length}</div>
        <div class="stat-label">Declined</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">${petsCount}</div>
        <div class="stat-label">Pets Coming</div>
      </div>
    `;

    const listEl = document.getElementById('guestList');

    if (guests.length === 0) {
      listEl.innerHTML = '<div class="admin-empty">No RSVPs yet. Share the link!</div>';
      return;
    }

    let html = `
      <div class="guest-row header">
        <span>Name</span>
        <span>Status</span>
        <span>People</span>
        <span>Pet</span>
      </div>
    `;

    guests.forEach(g => {
      html += `
        <div class="guest-row">
          <span class="guest-name">${escapeHtml(g.name)}</span>
          <span class="guest-status ${g.attending ? 'status-yes' : 'status-no'}">
            ${g.attending ? '‚úì Yes' : '‚úó No'}
          </span>
          <span class="guest-count">${g.attending ? g.guestCount : '‚Äî'}</span>
          <span class="guest-pet">${g.hasPet ? 'üêæ ' + escapeHtml(g.petName || 'Yes') : '‚Äî'}</span>
        </div>
      `;
    });

    listEl.innerHTML = html;
  }

  // =============================================
  // Utilities
  // =============================================
  function showMessage(el, type, text) {
    el.className = 'message ' + type;
    el.textContent = text;
    setTimeout(() => {
      if (el.textContent === text) el.className = 'message';
    }, 5000);
  }

  function escapeHtml(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  // Enter key support
  document.getElementById('lookupName').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') lookupRSVP();
  });
  document.getElementById('adminPass').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') doAdminLogin();
  });
</script>

</body>
</html>
